machine:
  ruby:
    version: system
  xcode:
    version: 7.3

dependencies:
  override:
    - sudo gem update --system
    - bundle install
    - |
      master_sha="$(ruby -e "puts '`git submodule status spec/fixtures/spec-repos/master`'.strip.sub(/^-/, '').split(/\s/, 2).first")"
      curl -ssL "https://github.com/CocoaPods/Specs/archive/$master_sha.tar.gz" | tar xz -C spec/fixtures/spec-repos
      git rm spec/fixtures/spec-repos/master
      mv "spec/fixtures/spec-repos/Specs-$master_sha" spec/fixtures/spec-repos/master
      (
      cd spec/fixtures/spec-repos/master
      git init
      git remote add origin https://github.com/CocoaPods/Specs.git
      )
      git submodule update --init
      mkdir -p ~/.cocoapods/repos/
      ln spec/fixtures/spec-repos/master ~/.cocoapods/repos/master 


test:
  pre:
    - git config --global user.email "tests@cocoapods.org"
    - git config --global user.name "CocoaPods Tests"
    - bundle exec pod env
  override:
    - bundle exec rake spec:all:
        timeout: 1200
        environment:
          COCOAPODS_CI_TASKS: EXAMPLES
          VERBOSE: true
